# Сервис аутентификации

## Описание
Сервис предоставляет два основных эндпоинта для аутентификации:
- `GET /auth` - Получение пары токенов
- `POST /refresh` - Обновление токенов

Документация API доступна в формате OpenAPI 3.0 в файле [openapi.yaml](docs/openapi.yaml).

---

## Установка и запуск

### Требования
- Docker и docker-compose
- Go 1.23+ (только для разработки и тестирования)

### Запуск сервиса
```bash
# Сборка и запуск контейнеров
make deploy

# Альтернативный вариант
docker-compose up --build
```

Миграция базы данных происходит автоматически при запуске контейнера

Порты:
- Сервис: `8080`
- PostgreSQL: `5432`

---

## Тестирование

### Предварительные условия
Для генерации моков требуется установить `mockgen`:
```bash
go install go.uber.org/mock/mockgen@latest
```

### Команды тестирования
```bash
# Запуск тестов с проверкой покрытия
make cover-test

# Запуск тестов без покрытия
make test

# Ручная генерация моков
make generate-mocks
```

*Примечание:* Моки не включены в репозиторий и генерируются автоматически при первом запуске тестов.

---

## Стек технологий
- **Веб - фреймворк**: Gin
- **Логирование**: Zap
- **СУБД**: PostgreSQL

---

## Детали реализации

### Система токенов
1. **Access-токены**:
    - Не хранятся в базе данных
    - Формируются с использованием JWT
    - В payload содержат собственный айди, guid владельца и ip-адрес, с которого он был запрошен

2. **Refresh-токены**:
    - Одноразовые
    - Представлены случайной последовательностью байт длиной 64
    - Срок действия по умолчанию 7 суток
    - Привязка к конкретному access - токену
    - Хранятся в базе данных в виде bcrypt - хеша

### Особенности пользователей
- При регистрации каждому пользователю присваивается случайный email (с помощью модуля faker)
- Реализована моковая отправка при условии, что айпи запроса на обновление токенов не совпадает с айпи запроса на выдачу access токена

---